{% extends "base.html" %}

{% load i18n %}
{% load bootstrap_tags %}

{% block head_title %}ITT Report{% endblock %}



{% block middle %}
<section class="container">
    <h1 class="text-3xl font-bold pb-2">ITT Statistics Report</h1>

    <div class="flex space-x-4">
        {% for month in months %}
            {% if not month.is_future %}
                <a href="{% url 'itt_stats' %}?month={{ month.number }}" class="px-4 py-2 cursor-pointer bg-gray-200 text-gray-700 rounded-full hover:bg-primary-300 transition-colors duration-200 ">
                    {{ month.name }}
                </a>
            {% endif %}
        {% endfor %}
    </div>

    {% comment %} <div class="flex space-x-4">
        <a href="{% url 'itt_stats' %}?month=1" class="px-4 py-2  cursor-pointer bg-gray-200 text-gray-700 rounded-full hover:bg-primary-300 transition-colors duration-200">
          January
        </a>
        <a href="{% url 'itt_stats' %}?month=2" class="px-4 py-2  cursor-pointer bg-gray-200 text-gray-700 rounded-full hover:bg-primary-300 transition-colors duration-200">
          February
        </a>
        <a href="{% url 'itt_stats' %}?month=3" class="px-4 py-2 cursor-pointer  bg-gray-200 text-gray-700 rounded-full hover:bg-primary-300 transition-colors duration-200">
          March
        </a>
        <a href="{% url 'itt_stats' %}?month=4" class="px-4 py-2 cursor-pointer  bg-gray-200 text-gray-700 rounded-full hover:bg-primary-300 transition-colors duration-200">
            April
        </a>
        <a href="{% url 'itt_stats' %}?month=5" class="px-4 py-2 cursor-pointer  bg-gray-200 text-gray-700 rounded-full hover:bg-primary-300 transition-colors duration-200">
            May
        </a>
        <a href="{% url 'itt_stats' %}?month=6" class="px-4 py-2 cursor-pointer  bg-gray-200 text-gray-700 rounded-full hover:bg-primary-300 transition-colors duration-200">
            June
        </a>
        <a href="{% url 'itt_stats' %}?month=7" class="px-4 py-2 cursor-pointer  bg-gray-200 text-gray-700 rounded-full hover:bg-primary-300 transition-colors duration-200">
            July
        </a>
        <a href="{% url 'itt_stats' %}?month=8" class="px-4 py-2 cursor-pointer  bg-gray-200 text-gray-700 rounded-full hover:bg-primary-300 transition-colors duration-200">
            August
        </a>
        <a href="{% url 'itt_stats' %}?month=9" class="px-4 py-2 cursor-pointer  bg-gray-200 text-gray-700 rounded-full hover:bg-primary-300 transition-colors duration-200">
            September
        </a>
        <a href="{% url 'itt_stats' %}?month=10" class="px-4 py-2 cursor-pointer  bg-gray-200 text-gray-700 rounded-full hover:bg-primary-300 transition-colors duration-200">
            October
        </a>
        <a href="{% url 'itt_stats' %}?month=11" class="px-4 py-2 cursor-pointer  bg-gray-200 text-gray-700 rounded-full hover:bg-primary-300 transition-colors duration-200">
            November
        </a>
        <a href="{% url 'itt_stats' %}?month=12" class="px-4 py-2 cursor-pointer  bg-gray-200 text-gray-700 rounded-full hover:bg-primary-300 transition-colors duration-200">
            December
        </a>
    </div> {% endcomment %}
    <hr/>
    
    <div class="flex grid-cols-4 gap-5 mt-20 mb-20">
        <div class="flex flex-col bg-gray-200 shadow-md rounded-lg p-6 mx-auto w-64">
            <div class="flex justify-between items-center">
                <div class="text-gray-700 font-bold text-xl">Active Users</div>
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="h-6 w-6 text-gray-500">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
            </div>
            <div class="mt-2 text-3xl font-semibold text-gray-900">{{ active_users }}</div>
            <div class="mt-2 text-gray-600">{{ change_phrase }}</div>
        </div>

        <div class="flex flex-col bg-gray-200 shadow-md rounded-lg p-6 mx-auto w-64">
            <div class="flex justify-between items-center">
                <div class="text-gray-700 font-bold text-xl">Staff Users</div>
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="h-6 w-6 text-gray-500">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
            </div>
            <div class="mt-2 text-3xl font-semibold text-gray-900">{{ staff_count }}</div>
        </div>

        <div class="flex flex-col bg-gray-200 shadow-md rounded-lg p-6 mx-auto w-64">
            <div class="flex justify-between items-center">
                <div class="text-gray-700 font-bold text-xl">Month Total Logins</div>
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="h-6 w-6 text-gray-500">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
            </div>
            <div class="mt-2 text-3xl font-semibold text-gray-900">{{ month_total_logins }}</div>
        </div>

        <!-- <div class="flex flex-col bg-gray-200 shadow-md rounded-lg p-6 mx-auto w-64">
            <div class="flex justify-between items-center">
                <div class="text-gray-700 font-bold text-xl">Active Users Current Month</div>
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="h-6 w-6 text-gray-500">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
            </div>
            <div class="mt-2 text-3xl font-semibold text-gray-900">{{ active_users_current_month }}</div>
        </div> -->
    </div>
    <hr/>

    <h4 class="font-bold text-lg">Month Active Users</h4>
    <table class="min-w-full divide-y divide-gray-200 mb-10">
        <thead class="bg-gray-50">
            <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">First Name</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Last Name</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Organization</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Country</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Active</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Last Login</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Login Count</th>
            </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
            {% for users_list in active_users_list %}
                <tr>
                    <td class="px-6 py-4 whitespace-nowrap">{{ users_list.user__first_name }}</td>
                    <td class="px-6 py-4 whitespace-nowrap">{{ users_list.user__last_name }}</td>
                    <td class="px-6 py-4 whitespace-nowrap">{{ users_list.user__email }}</td>
                    <td class="px-6 py-4 whitespace-nowrap">{{ users_list.user__organization }}</td>
                    <td class="px-6 py-4 whitespace-nowrap">{{ users_list.user__country }}</td>
                    <td class="px-6 py-4 whitespace-nowrap">{{ users_list.user__is_active }}</td>
                    <td class="px-6 py-4 whitespace-nowrap">{{ users_list.last_login }}</td>
                    <td class="px-6 py-4 whitespace-nowrap">{{ users_list.login_count }}</td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="3" class="px-6 py-4 whitespace-nowrap">No active users found for this month.</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
    <hr/>

    <div class="flex space-x-4 w-full mb-10">
        <!-- Users Per Position -->
        <div class="w-full">
            <h4 class="font-bold text-lg">Users Per Position</h4>
            <table class="min-w-full divide-y divide-gray-200 mb-6">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Position</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total User Count</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    {% for user_position in users_per_position %}
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap">{{ user_position.user__position }}</td>
                            <td class="px-6 py-4 whitespace-nowrap">{{ user_position.user_count }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    
        <!-- Users Per Country -->
        <div class="w-full">
            <h4 class="font-bold text-lg">Users Per Country</h4>
            <table class="min-w-full divide-y divide-gray-200 mb-6">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Country</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total User Count</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    {% for user_country in users_per_country %}
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap">{{ user_country.user__country }}</td>
                            <td class="px-6 py-4 whitespace-nowrap">{{ user_country.user_count }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    <hr/>

    <h4 class="font-bold text-lg">Users Per Organization</h4>
    <table class="min-w-full divide-y divide-gray-200 mb-10">
        <thead class="bg-gray-50">
            <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Organization</th>
                <!-- <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total User Count</th> -->
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Active User Count</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Inactive User Count</th>
            </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
            {% for user_org in users_per_org %}
                <tr>
                    <td class="px-6 py-4 whitespace-nowrap">{{ user_org.user__organization }}</td>
                    <!-- <td class="px-6 py-4 whitespace-nowrap">{{ user_org.user_count }}</td> -->
                    <td class="px-6 py-4 whitespace-nowrap">{{ user_org.active_user_count }}</td>
                    <td class="px-6 py-4 whitespace-nowrap">{{ user_org.inactive_user_count }}</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <h4 class="font-bold text-lg">Datasets</h4>
    <table class="min-w-full divide-y divide-gray-200 mb-10">
        <thead class="bg-gray-50">
            <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Owner</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Owner Organization</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Resource Type</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Popular Count</th>  
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Created</th>   
            </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
            {% for dataset in datasets_in_month %}
                <tr>
                    <td class="px-6 py-4 whitespace-nowrap">{{ dataset.owner }}</td>
                    <td class="px-6 py-4 whitespace-nowrap">{{ dataset.owner.organization }}</td>
                    <td class="px-6 py-4 whitespace-nowrap">{{ dataset.name }}</td>
                    <td class="px-6 py-4 whitespace-nowrap">{{ dataset.popular_count }}</td>
                    <td class="px-6 py-4 whitespace-nowrap">{{ dataset.created }}</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>



</section>
{% endblock middle %}